def mvnHome
def remote = [:]
         remote.name = 'ansible'
         remote.host = '172.31.30.225'
         remote.user = 'centos'
         remote.password = 'Rnstech@123'
         remote.allowAnyHosts = true

pipeline {
   agent none
    
   stages {
      stage('Prepare Workspace') {
         agent {
              label 'BuildServer'
          }
         steps {
            // Get src code from a GitHub repository
            git credentialsId: 'github_un-pwd', url: 'https://github.com/venkat09docs/Maven-Java-Project.git'
            
            script{
                mvnHome = tool name: 'maven3.6', type: 'maven'
            }      
      }   
      }
      
      stage('Setup Tools'){
         agent {
              label 'BuildServer'
          }
          steps{
          
            sshCommand remote: remote, command: 'cd Maven-Java-Project; git pull'
            //sshCommand remote: remote, command: 'cd Maven-Java-Project; ansible-playbook -i hosts tools/sonarqube/sonar-install.yaml'
            //sshCommand remote: remote, command: 'cd Maven-Java-Project; ansible-playbook -i hosts tools/docker/docker-install.yml'
          }
      }      
      stage('SonarQube analysis') {
         agent {
              label 'BuildServer'
          }
          steps{
                 withSonarQubeEnv('sonar-7') { // You can override the credential to be used
                           sh 'mvn sonar:sonar'
                  }
          }
      }
   }
}
